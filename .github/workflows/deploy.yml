name: GitHub Pages Astro CI

on:
  # 每次推送到 `main` 分支时触发这个“工作流程”
  # 如果你使用了别的分支名，请按需将 `main` 替换成你的分支名
  push:
    branches: [ main ]
  # 允许你在 GitHub 上的 Actions 标签中手动触发此“工作流程”
  workflow_dispatch:
  
# 允许 job 克隆 repo 并创建一个 page deployment
permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  pages: # 必须定义一个名为 pages 的 job
    image: node:latest
    stage: deploy
    script:
      - npm ci
      - npm run build
      - mv public public-vue # GitLab Pages 的钩子设置在 public 文件夹
      - mv dist public # 重命名 dist 文件夹 (npm run build 之后的输出位置)
    artifacts:
      paths:
        - public # artifact path 一定要在 /public , 这样 GitLab Pages 才能获取
    only:
      - main
